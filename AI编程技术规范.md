# AI 协作开发简明规范

面向多技术栈的最小共识，强调可读、可测、可交付。

## 基本原则

- 优先清晰胜过炫技：易读、易测试、易回滚。
- 一致性高于个人偏好：同仓库统一格式化、命名、目录约定。
- 记录决策：非常规做法写明动机、风险与清除条件。

## 代码与项目约定

- 语言与依赖：优先使用具备类型支持的主流语言；
- 格式化与校验：仓库提供统一 lint/format 脚本，提交前运行，CI 重复执行。
- 命名：标识符 camelCase，常量 UPPER_SNAKE_CASE，类型/类/组件 PascalCase；API 路径遵循 RESTful 风格。
- 目录与职责：按分层或领域拆分（如 controllers/services/models 或 components/views/utils）；文件尽量单一职责，建议控制在约 400 行，超出需拆分。
- 注释：解释“为什么”而非“做什么”；临时 hack 要注明清理计划。

## 接口与数据

- 输入校验与错误结构统一，避免暴露内部异常细节。
- 接口风格保持一致（REST、RPC、GraphQL 任一即可，但需统一）；响应包含成功标记与可追踪错误码。
- 数据迁移脚本可重复执行；存储（文件/对象）目录与命名规则前置约定并文档化。

## 安全与配置

- 配置集中管理：环境变量加载，提供默认值与校验；密钥不入仓库。
- 基础安全：鉴权、速率限制、CORS/Helmet/Compression 按需启用；上传需校验类型和大小。
- 日志与监控：结构化输出，至少含时间戳、级别、请求/用户标识；关键操作接入告警链路。

## 测试与质量

- 优先测试驱动：新增功能需有正/反向用例，核心路径必须覆盖。
- 用例结构清晰（describe/it），断言统一；能集成测试就不要过度 mock。
- 覆盖率指标由团队约定，CI 至少运行 lint + test + 构建。

## 前端协作（通用）

- 组件化与状态：共享逻辑抽成可复用模块/组合式函数；状态按域拆分，可持久化。
- 性能与体验：首屏按需加载，谨慎引入大体积依赖；请求统一封装（超时、重试、鉴权、错误提示）。
- 可访问与多语言：文案统一管理，遵循基本 ARIA 要求；键盘可用。

## 后端协作（通用）

- 分层架构：路由 → 控制器 → 服务 → 数据访问；中间件职责单一、可复用。
- 错误与审计：错误信息可追踪且不泄漏内部细节；敏感操作写审计日志。
- 任务与队列：异步任务需可追踪，失败有重试或补偿策略。

## 部署与交付

- 环境分级：区分本地/测试/预发/生产，配置差异文档化。
- 自动化：提供一键开发、测试、构建、启动脚本；CI/CD 流水线顺序清晰（依赖 → 检查 → 测试 → 构建 → 部署）。
- 容器化：镜像尽量小且可缓存；外部端口、卷和资源限制有默认值与说明。

## AI 协作流程

- 明确需求：先列假设与风险，必要时确认；任务拆分成可执行清单。
- 少即是多：优先最小可行变更，避免一次性大改；破坏性操作前先备份或提供回滚方案。
- 验证闭环：实现后说明影响面、验证方式与后续待办；文档和环境变量变更要同步更新。
