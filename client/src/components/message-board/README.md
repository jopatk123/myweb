# 图片预览组件拆分说明

## 概述

原来的 `ImagePreview.vue` 文件代码量较大（549行），包含了多个功能模块，不易维护。现已按照功能模块进行了合理的拆分。

## 拆分后的文件结构

### 主组件
- **`ImagePreview.vue`** - 主组件，整合所有子组件和逻辑

### 子组件
- **`ImageGrid.vue`** - 图片网格组件，负责显示图片缩略图
- **`LightboxViewer.vue`** - 灯箱查看器组件，负责全屏查看图片
- **`ContextMenu.vue`** - 右键菜单组件，提供快捷操作

### 可复用逻辑 (Composables)
- **`useImagePreview.js`** - 图片预览相关逻辑（URL获取、加载处理等）
- **`useLightbox.js`** - 灯箱相关逻辑（打开/关闭、切换图片等）
- **`useContextMenu.js`** - 右键菜单相关逻辑（显示/隐藏、事件处理等）
- **`useImageDownload.js`** - 图片下载相关逻辑（保存图片、成功提示等）

## 功能模块说明

### 1. 图片网格 (ImageGrid)
- 显示图片缩略图网格
- 支持单张图片和多张图片的不同布局
- 图片悬停效果
- 点击和右键事件处理

### 2. 灯箱查看器 (LightboxViewer)
- 全屏图片查看
- 多图片导航（上一张/下一张）
- 图片指示器
- 保存图片功能
- 响应式设计

### 3. 右键菜单 (ContextMenu)
- 查看图片
- 保存图片
- 自动关闭机制

### 4. 可复用逻辑
- **useImagePreview**: 处理图片URL获取和加载事件
- **useLightbox**: 管理灯箱状态和导航
- **useContextMenu**: 管理右键菜单状态和事件
- **useImageDownload**: 处理图片下载和用户反馈

## 优势

1. **可维护性**: 每个文件职责单一，易于理解和修改
2. **可复用性**: Composables 可以在其他组件中复用
3. **可测试性**: 每个模块可以独立测试
4. **代码组织**: 逻辑清晰，结构合理

## 使用方式

主组件的使用方式保持不变：

```vue
<ImagePreview :images="messageImages" />
```

## 注意事项

- 所有子组件都通过事件与主组件通信
- 样式使用 scoped 避免冲突
- 全局样式（如保存成功提示）使用 `:global()` 选择器
- 键盘事件监听在主组件中统一处理
